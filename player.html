<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Voice-Wei: Voice-controlled music player">
    <title>Music - Voice-Wei</title>
    <link rel="stylesheet" href="style.css?v=30">
</head>

<body>
    <div class="container">
        <header>
            <div class="header-top">
                <h1>Music</h1>
                <span class="version-label">v0.30</span>
                <nav class="nav-tabs">
                    <a href="scales.html" class="nav-tab">Scales</a>
                    <a href="pitch-meter.html" class="nav-tab">Pitch</a>
                    <a href="player.html" class="nav-tab active">Music</a>
                    <a href="ebook.html" class="nav-tab">Books</a>
                </nav>
                <button id="settingsBtn" class="settings-btn" aria-label="Settings">⚙</button>
            </div>
        </header>

        <div class="settings-panel" id="settingsPanel" style="display: none;">
            <h2>Settings</h2>

            <!-- AI Provider Selection -->
            <div class="setting-item">
                <label for="aiProvider">AI Provider:</label>
                <select id="aiProvider" class="model-selector">
                    <option value="claude">Claude (Anthropic)</option>
                    <option value="openai">OpenAI (GPT)</option>
                </select>
                <p class="setting-description">Choose which AI to use for interpreting music requests.</p>
            </div>

            <!-- Claude API Key Section -->
            <div class="setting-item api-key-section" id="claudeApiSection">
                <label for="claudeApiKeyInput">Claude API Key:</label>
                <div class="api-key-status" id="claudeApiKeyStatus"></div>
                <div class="api-key-input-row" id="claudeApiKeyInputRow" style="display: none;">
                    <input type="password" id="claudeApiKeyInput" placeholder="sk-ant-..." class="api-key-input" />
                    <button id="saveClaudeApiKeyBtn" class="save-api-key-btn">Save</button>
                </div>
                <div class="api-key-actions" id="claudeApiKeyActions" style="display: none;">
                    <button id="showClaudeApiKeyBtn" class="api-key-action-btn">Show</button>
                    <button id="changeClaudeApiKeyBtn" class="api-key-action-btn">Change</button>
                    <button id="removeClaudeApiKeyBtn" class="api-key-action-btn danger">Remove</button>
                </div>
                <p class="setting-description">Get your key from <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a></p>
            </div>

            <!-- OpenAI API Key Section -->
            <div class="setting-item api-key-section" id="openaiApiSection" style="display: none;">
                <label for="openaiApiKeyInput">OpenAI API Key:</label>
                <div class="api-key-status" id="openaiApiKeyStatus"></div>
                <div class="api-key-input-row" id="openaiApiKeyInputRow" style="display: none;">
                    <input type="password" id="openaiApiKeyInput" placeholder="sk-..." class="api-key-input" />
                    <button id="saveOpenaiApiKeyBtn" class="save-api-key-btn">Save</button>
                </div>
                <div class="api-key-actions" id="openaiApiKeyActions" style="display: none;">
                    <button id="showOpenaiApiKeyBtn" class="api-key-action-btn">Show</button>
                    <button id="changeOpenaiApiKeyBtn" class="api-key-action-btn">Change</button>
                    <button id="removeOpenaiApiKeyBtn" class="api-key-action-btn danger">Remove</button>
                </div>
                <p class="setting-description">Get your key from <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com</a></p>
            </div>

            <div class="setting-item">
                <label>
                    <input type="checkbox" id="readClaudeResponse" />
                    <span>Read AI responses aloud</span>
                </label>
            </div>
            <div class="setting-item">
                <label>
                    <input type="checkbox" id="autoSubmitMode" checked />
                    <span>Auto-submit when done talking</span>
                </label>
                <p class="setting-description">Auto: Submits after you pause. Manual: Keeps listening until you say
                    "submit" or click Submit button.</p>
            </div>

            <!-- Claude Model Selection -->
            <div class="setting-item" id="claudeModelSection">
                <label for="claudeModel">Claude Model:</label>
                <select id="claudeModel" class="model-selector">
                    <option value="claude-opus-4-5-20251101">Opus 4.5</option>
                    <option value="claude-haiku-4-5-20250514">Haiku 4.5 (unverified)</option>
                </select>
            </div>

            <!-- OpenAI Model Selection -->
            <div class="setting-item" id="openaiModelSection" style="display: none;">
                <label for="openaiModel">OpenAI Model:</label>
                <select id="openaiModel" class="model-selector">
                    <option value="gpt-4o">GPT-4o</option>
                    <option value="gpt-4o-mini">GPT-4o Mini (faster)</option>
                    <option value="gpt-4-turbo">GPT-4 Turbo</option>
                </select>
            </div>

            <button id="closeSettingsBtn" class="close-settings-btn">Close</button>
        </div>

        <!-- API Key Setup Overlay (shown when no key is configured) -->
        <div class="api-key-overlay" id="apiKeyOverlay" style="display: none;">
            <div class="api-key-overlay-content">
                <h2>API Key Required</h2>
                <p>This app uses AI to understand your music requests. Enter your API key from either provider:</p>

                <div class="overlay-provider-tabs">
                    <button class="provider-tab active" data-provider="claude">Claude</button>
                    <button class="provider-tab" data-provider="openai">OpenAI</button>
                </div>

                <div class="overlay-provider-section" id="overlayClaudeSection">
                    <p class="provider-hint">Get your key from <a href="https://console.anthropic.com/" target="_blank" rel="noopener">console.anthropic.com</a></p>
                    <div class="api-key-input-row">
                        <input type="password" id="claudeApiKeyOverlayInput" placeholder="sk-ant-..." class="api-key-input" />
                        <button id="saveClaudeApiKeyOverlayBtn" class="save-api-key-btn">Save</button>
                    </div>
                </div>

                <div class="overlay-provider-section" id="overlayOpenaiSection" style="display: none;">
                    <p class="provider-hint">Get your key from <a href="https://platform.openai.com/api-keys" target="_blank" rel="noopener">platform.openai.com</a></p>
                    <div class="api-key-input-row">
                        <input type="password" id="openaiApiKeyOverlayInput" placeholder="sk-..." class="api-key-input" />
                        <button id="saveOpenaiApiKeyOverlayBtn" class="save-api-key-btn">Save</button>
                    </div>
                </div>

                <p class="api-key-privacy-note">Your API key is stored only in this browser's localStorage. It never
                    leaves your device except to call the AI API directly.</p>
            </div>
        </div>

        <main>
            <div class="central-player" id="centralPlayer" style="display: none;">
                <div class="player-info">
                    <div class="player-song-title" id="playerSongTitle"></div>
                    <div class="player-song-artist" id="playerSongArtist"></div>
                </div>
                <div class="progress-bar-container" id="progressBarContainer">
                    <div class="progress-bar-track" id="progressBarTrack">
                        <div class="progress-bar-fill" id="progressBarFill"></div>
                        <div class="progress-bar-handle" id="progressBarHandle"></div>
                    </div>
                    <div class="progress-time">
                        <span id="currentTime">0:00</span>
                        <span id="totalTime">0:00</span>
                    </div>
                </div>
                <div class="player-controls">
                    <button id="prevBtn" class="control-btn" aria-label="Previous">⏮</button>
                    <button id="playPauseBtn" class="control-btn control-btn-large" aria-label="Play/Pause">▶</button>
                    <button id="stopBtn" class="control-btn" aria-label="Stop">⏹</button>
                    <button id="nextBtn" class="control-btn" aria-label="Next">⏭</button>
                </div>
                <div class="player-controls-secondary">
                    <button id="rewindBtn" class="control-btn-small" aria-label="Rewind">⏪</button>
                    <button id="forwardBtn" class="control-btn-small" aria-label="Fast Forward">⏩</button>
                </div>
            </div>

            <div class="status" id="status">Ready</div>

            <div class="voice-controls-row">
                <button id="listenBtn" class="listen-button" aria-label="Start listening">
                    <span class="button-text">Listen</span>
                    <span class="button-icon">&#9834;</span>
                </button>
                <button id="submitBtn" class="submit-button-large" style="display: none;"
                    aria-label="Submit">Submit</button>
            </div>

            <div class="transcript-container" id="transcriptContainer" style="display: none;">
                <p class="transcript-label">You said:</p>
                <p class="transcript" id="transcript"></p>
            </div>

            <div class="quick-actions" id="quickActions">
                <button id="loadFavoritesBtnMain" class="quick-action-btn">Load Favorites</button>
            </div>

            <div class="playlist-container" id="playlistContainer" style="display: none;">
                <div class="playlist-header">
                    <span class="playlist-label" id="playlistLabel">Playlist:</span>
                    <button id="loadFavoritesBtn" class="load-favorites-btn">Load Favorites</button>
                    <button id="clearPlaylistBtn" class="clear-playlist-btn">Clear</button>
                </div>
                <table class="playlist-table" id="playlist">
                    <thead>
                        <tr>
                            <th class="fav-col"></th>
                            <th>Artist</th>
                            <th>Song</th>
                            <th>Year</th>
                            <th>Album</th>
                            <th>Length</th>
                        </tr>
                    </thead>
                    <tbody id="playlistBody"></tbody>
                </table>
            </div>

            <div class="log-container" id="logContainer">
                <div class="log-header">
                    <span class="log-label">Log</span>
                    <button id="selectAllLogBtn" class="select-all-btn">Select All</button>
                    <button id="copyAllLogBtn" class="copy-all-btn">Copy All</button>
                    <button id="clearLogBtn" class="clear-log-btn">Clear</button>
                </div>
                <div class="log-content" id="logContent"></div>
            </div>

            <footer class="page-footer">
                <button onclick="location.reload(true)" class="footer-btn">Hard Refresh</button>
                <a href="https://github.com/ernop/voice-wei" target="_blank" class="footer-link">GitHub</a>
            </footer>
        </main>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="voice-output.js?v=30"></script>
    <script src="voice-command-core.js?v=30"></script>
    <script src="app.js?v=30"></script>
</body>

</html>