<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Voice-Wei: Ebook to Audiobook converter using OpenAI TTS">
    <meta name="robots" content="noindex, nofollow">
    <title>Books - Voice-Wei</title>
    <link rel="stylesheet" href="style.css?v=31">
    <link rel="stylesheet" href="ebook.css?v=31">
</head>

<body>
    <div class="container">
        <header>
            <div class="header-top">
                <h1>Books</h1>
                <span class="version-label">v31</span>
                <nav class="nav-tabs">
                    <a href="scales.html" class="nav-tab">Scales</a>
                    <a href="pitch-meter.html" class="nav-tab">Pitch</a>
                    <a href="player.html" class="nav-tab">Music</a>
                    <a href="ebook.html" class="nav-tab active">Books</a>
                </nav>
                <button id="settingsBtn" class="settings-btn" aria-label="Settings">&#9881;</button>
            </div>
        </header>

        <div class="settings-panel" id="settingsPanel" style="display: none;">
            <h2>Settings</h2>

            <div class="setting-item api-key-section">
                <label for="openaiApiKeyInput">OpenAI API Key:</label>
                <div class="api-key-status" id="apiKeyStatus"></div>
                <div class="api-key-input-row" id="apiKeyInputRow" style="display: none;">
                    <input type="password" id="openaiApiKeyInput" placeholder="sk-..." class="api-key-input" />
                    <button id="saveApiKeyBtn" class="save-api-key-btn">Save</button>
                </div>
                <div class="api-key-actions" id="apiKeyActions" style="display: none;">
                    <button id="showApiKeyBtn" class="api-key-action-btn">Show</button>
                    <button id="changeApiKeyBtn" class="api-key-action-btn">Change</button>
                    <button id="removeApiKeyBtn" class="api-key-action-btn danger">Remove</button>
                </div>
                <p class="setting-description">Your API key is stored only in this browser's localStorage. It never
                    leaves your device except to call OpenAI's API directly.</p>
            </div>

            <div class="setting-item">
                <label for="ttsVoice">TTS Voice:</label>
                <div class="voice-selector-row">
                    <select id="ttsVoice" class="model-selector">
                        <option value="alloy">Alloy - Neutral, balanced</option>
                        <option value="echo">Echo - Male, clear</option>
                        <option value="fable">Fable - British accent</option>
                        <option value="onyx">Onyx - Deep male</option>
                        <option value="nova">Nova - Female, warm</option>
                        <option value="shimmer">Shimmer - Soft female</option>
                    </select>
                    <button id="previewVoiceBtn" class="preview-voice-btn" title="Preview voice">&#9654;</button>
                </div>
                <p class="setting-description" id="voiceDescription">Neutral and balanced, good for most content.</p>
            </div>

            <div class="setting-item">
                <label for="ttsModel">TTS Model:</label>
                <select id="ttsModel" class="model-selector">
                    <option value="tts-1">TTS-1 - Fast ($0.015/1K chars)</option>
                    <option value="tts-1-hd">TTS-1-HD - High Quality ($0.030/1K chars)</option>
                </select>
                <p class="setting-description">HD model has clearer pronunciation and better intonation.</p>
            </div>

            <div class="setting-item">
                <label for="ttsSpeed">TTS Speed:</label>
                <div class="speed-control">
                    <input type="range" id="ttsSpeed" min="0.25" max="4.0" step="0.25" value="1.0" class="speed-slider">
                    <span id="ttsSpeedValue">1.0x</span>
                </div>
                <p class="setting-description">0.25x (very slow) to 4.0x (very fast). Default 1.0x.</p>
            </div>

            <button id="closeSettingsBtn" class="close-settings-btn">Close</button>
        </div>

        <!-- API Key Setup Overlay (shown when no key is configured) -->
        <div class="api-key-overlay" id="apiKeyOverlay" style="display: none;">
            <div class="api-key-overlay-content">
                <h2>OpenAI API Key Required</h2>
                <p>This app uses OpenAI's text-to-speech to convert ebooks to audio. You'll need your own API key from <a
                        href="https://platform.openai.com/api-keys" target="_blank" rel="noopener">platform.openai.com</a>.
                </p>
                <div class="api-key-input-row">
                    <input type="password" id="openaiApiKeyOverlayInput" placeholder="sk-..."
                        class="api-key-input" />
                    <button id="saveApiKeyOverlayBtn" class="save-api-key-btn">Save</button>
                </div>
                <p class="api-key-privacy-note">Your API key is stored only in this browser's localStorage. It never
                    leaves your device except to call OpenAI's API directly.</p>
            </div>
        </div>

        <main>
            <div class="status" id="status">Upload an ebook to get started</div>

            <!-- File Upload Section -->
            <div class="upload-section">
                <div class="upload-area" id="uploadArea">
                    <input type="file" id="fileInput" accept=".txt,.epub,.pdf,.html,.htm" hidden />
                    <div class="upload-icon">&#128214;</div>
                    <p class="upload-text">Drop ebook here or click to upload</p>
                    <p class="upload-formats">Supported: TXT, EPUB, PDF, HTML</p>
                </div>
            </div>

            <!-- Book Info Section (shown after upload) -->
            <div class="book-info" id="bookInfo" style="display: none;">
                <div class="book-header">
                    <h2 id="bookTitle">Book Title</h2>
                    <div class="book-meta">
                        <span id="bookAuthor"></span>
                        <span id="bookStats"></span>
                    </div>
                </div>
                <div class="book-actions">
                    <button id="convertBtn" class="convert-btn" disabled>
                        <span class="btn-icon">&#127925;</span>
                        <span class="btn-text">Convert to MP3</span>
                    </button>
                    <button id="clearBookBtn" class="clear-book-btn">Clear</button>
                </div>
            </div>

            <!-- Conversion Progress (shown during conversion) -->
            <div class="conversion-progress" id="conversionProgress" style="display: none;">
                <div class="progress-header">
                    <span id="conversionStatus">Converting...</span>
                    <button id="cancelConversionBtn" class="cancel-btn">Cancel</button>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-track">
                        <div class="progress-bar-fill" id="conversionProgressFill"></div>
                    </div>
                </div>
                <div class="progress-stats">
                    <span id="progressChunks">0 / 0 chunks</span>
                    <span id="progressTime">Estimated: --</span>
                </div>
            </div>

            <!-- Audio Player (shown after conversion) -->
            <div class="audio-section" id="audioSection" style="display: none;">
                <div class="audio-header">
                    <h3>Audiobook Ready</h3>
                    <button id="downloadAudioBtn" class="download-btn">
                        <span class="btn-icon">&#11015;</span>
                        <span class="btn-text">Download MP3</span>
                    </button>
                </div>
                <audio id="audioPlayer" controls class="audio-player"></audio>
            </div>

            <!-- Chapter Navigation (for epub) -->
            <div class="chapter-nav" id="chapterNav" style="display: none;">
                <h3>Chapters</h3>
                <div class="chapter-list" id="chapterList"></div>
            </div>

            <!-- Image Gallery Section -->
            <div class="image-section" id="imageSection" style="display: none;">
                <div class="image-section-header">
                    <h3>Images &amp; Figures</h3>
                    <span class="image-count" id="imageCount">0 images</span>
                </div>
                <div class="image-gallery" id="imageGallery"></div>
            </div>

            <!-- Image Fullscreen Overlay -->
            <div class="image-overlay" id="imageOverlay" style="display: none;">
                <button class="overlay-close" id="closeImageOverlay">&times;</button>
                <button class="overlay-nav overlay-prev" id="prevImage">&#10094;</button>
                <div class="overlay-content">
                    <img id="fullscreenImage" src="" alt="" />
                    <div class="overlay-caption" id="fullscreenCaption"></div>
                </div>
                <button class="overlay-nav overlay-next" id="nextImage">&#10095;</button>
            </div>

            <!-- Text Preview Section -->
            <div class="text-preview-section" id="textPreviewSection" style="display: none;">
                <div class="preview-header">
                    <h3>Text Preview</h3>
                    <div class="preview-actions">
                        <button id="selectAllTextBtn" class="select-all-btn">Select All</button>
                        <button id="copyTextBtn" class="copy-all-btn">Copy</button>
                    </div>
                </div>
                <div class="text-preview" id="textPreview"></div>
            </div>

            <!-- Log Section -->
            <div class="log-container" id="logContainer">
                <div class="log-header">
                    <span class="log-label">Log</span>
                    <button id="clearLogBtn" class="clear-log-btn">Clear</button>
                </div>
                <div class="log-content" id="logContent"></div>
            </div>

            <footer class="page-footer">
                <button onclick="location.reload(true)" class="footer-btn">Hard Refresh</button>
                <a href="https://github.com/ernop/voice-wei" target="_blank" class="footer-link">GitHub</a>
            </footer>
        </main>
    </div>

    <!-- PDF.js for PDF parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <!-- JSZip for EPUB parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="ebook.js?v=31"></script>
</body>

</html>
